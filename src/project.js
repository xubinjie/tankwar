require=function c(o,s,r){function l(e,t){if(!s[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,c,o,s,r)}return s[e].exports}for(var h="function"==typeof require&&require,t=0;t<r.length;t++)l(r[t]);return l}({AssetsLoadScript:[function(t,e,i){"use strict";cc._RF.push(e,"dbc42i0xlVKnap/Lbb+PPHz","AssetsLoadScript"),cc.Class({extends:cc.Component,properties:{numLabel:cc.Label},onLoad:function(){var a=this,t=[{id:"tank",url:cc.url.raw("resources/tank.plist")}];cc.LoadingItems.create(cc.loader,t,function(t,e,i){var n=(100*t/e).toFixed(2);cc.log(n+"%"),a.numLabel.string=Math.abs(n)+"%",console.log("=========="+i.url)},function(t,e){if(t)for(var i=0;i<t.length;++i)cc.log("Error url: "+t[i]+", error: "+e.getError(t[i]));else console.log(e.totalCount)})}}),cc._RF.pop()},{}],BlastScript:[function(t,e,i){"use strict";cc._RF.push(e,"5b5e1COo/dBsbkA/Ng9jaEv","BlastScript"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},playFinish:function(){this.node.parent=null}}),cc._RF.pop()},{}],BulletScript:[function(t,e,i){"use strict";cc._RF.push(e,"f2438tTsclDlKMotV5yR31a","BulletScript");t("TankData").tankType;cc.Class({extends:cc.Component,properties:{speed:20},onLoad:function(){this._cityCtrl=cc.find("/CityScript").getComponent("CityScript")},reuse:function(t){this.bulletPool=t},bulletMove:function(){var t=90-this.node.rotation;this.offset=0==t||180==t||90==t?cc.v2(Math.floor(Math.cos(Math.PI/180*t)),Math.floor(Math.sin(Math.PI/180*t))):270==t?cc.v2(Math.ceil(Math.cos(Math.PI/180*t)),Math.floor(Math.sin(Math.PI/180*t))):cc.v2(Math.cos(Math.PI/180*t),Math.sin(Math.PI/180*t))},bulletBoom:function(){this.node.parent=null,this.bulletPool.put(this.node)},update:function(t){this.node.x+=this.offset.x*this.speed*t,this.node.y+=this.offset.y*this.speed*t;var e=this.node.getBoundingBox();(this._cityCtrl.collisionTest(e,!0)||this.collisionTank(e))&&this.bulletBoom()},collisionTank:function(t){for(var e=0;e<cc.gameData.tankList.length;e++){var i=cc.gameData.tankList[e],n=i.getComponent("TankScript");if(n.team!=this.node.tag&&!n.die){var a=i.getBoundingBox();if(cc.rectIntersectsRect(t,a))return--n.blood<=0&&n.boom(),!0}}return!1}}),cc._RF.pop()},{TankData:"TankData"}],ChoiceScript:[function(t,e,i){"use strict";cc._RF.push(e,"e3410Xfj7dGI7X2/mwrPXFs","ChoiceScript"),cc.Class({extends:cc.Component,properties:{curLevelLabel:cc.Label},onLoad:function(){cc.gameData={},cc.gameData.curLevel=1,this.updateLevelLabel()},onPlay:function(){cc.loader.onProgress=function(t,e,i){console.log(t+"/"+e)},cc.director.preloadScene("CityScene"+cc.gameData.curLevel,function(t,e){cc.director.loadScene("CityScene"+cc.gameData.curLevel)})},onUp:function(){cc.gameData.curLevel-1<=0||(cc.gameData.curLevel-=1,this.updateLevelLabel())},onNext:function(){20<cc.gameData.curLevel+1||(cc.gameData.curLevel+=1,this.updateLevelLabel())},updateLevelLabel:function(){this.curLevelLabel.string="Round "+cc.gameData.curLevel}}),cc._RF.pop()},{}],CityScript:[function(a,t,e){"use strict";cc._RF.push(t,"7f0b08Dcw5F7oWFl36ggKRC","CityScript");var n=a("TankData").tankType;cc.Class({extends:cc.Component,properties:{curMap:cc.TiledMap,yaogan:cc.Node,bullet:cc.Prefab,tank:{default:null,type:cc.Prefab},maxCount:5,bornPoses:{default:[],type:cc.Vec2},spriteFrames:{default:[],type:cc.SpriteFrame},tankSpeeds:{default:[],type:cc.Float},tankFireTimes:{default:[],type:cc.Float},tankBloods:{default:[],type:cc.Integer}},onLoad:function(){cc.director.setDisplayStats(!0),this._joystickCtrl=this.yaogan.getComponent("JoystickCtrl"),this._tiledMap=this.curMap.getComponent("cc.TiledMap")},start:function(t){if(!t){this.curAngle=null;this.registerInputEvent(),this._tiledMapData=a("TiledMapData"),this._curMapTileSize=this._tiledMap.getTileSize(),this._curMapSize=cc.v2(this._tiledMap.node.width,this._tiledMap.node.height),this.mapLayer0=this._tiledMap.getLayer("layer_0"),this.bulletPool=new cc.NodePool("BulletScript");for(var e=0;e<20;++e){var i=cc.instantiate(this.bullet);this.bulletPool.put(i)}this.tankPool=new cc.NodePool("TankScript");for(e=0;e<this.maxCount;++e){var n=cc.instantiate(this.tank);this.tankPool.put(n)}cc.gameData||(cc.gameData={}),cc.gameData.teamId=0,cc.gameData.single=!0,cc.gameData.tankList=[],cc.gameData.bulletList=[],this.tankNode=cc.find("/Canvas/Map/tank"),this.player=this.addPlayerTank(),this._playerTankCtrl=this.player.getComponent("TankScript"),this.schedule(this.addAITank,3,cc.macro.REPEAT_FOREVER,1)}},registerInputEvent:function(){var i=this;this._joystickCtrl.addJoyStickTouchChangeListener(function(t){(t!=i.curAngle||i._playerTankCtrl.stopMove)&&(null!=(i.curAngle=t)?i._playerTankCtrl.tankMoveStart(t):i._playerTankCtrl.tankMoveStop())}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(t){var e=null;switch(t.keyCode){case cc.KEY.w:e=90;break;case cc.KEY.s:e=270;break;case cc.KEY.a:e=180;break;case cc.KEY.d:e=0}t.keyCode==cc.KEY.k?this.fireBtnClick():i._playerTankCtrl.tankMoveStop(),null!=e&&i._playerTankCtrl.tankMoveStart(e)},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(t){t.keyCode!=cc.KEY.k&&i._playerTankCtrl.tankMoveStop()},this)},collisionTest:function(t,e){if(t.xMin<=-this._curMapSize.x/2||t.xMax>=this._curMapSize.x/2||t.yMin<=-this._curMapSize.y/2||t.yMax>=this._curMapSize.y/2)return!0;var i=this._curMapSize.y/2-t.yMin,n=this._curMapSize.y/2-t.yMax,a=this._curMapSize.x/2+t.xMin,c=this._curMapSize.x/2+t.xMax,o=cc.v2(a,i),s=cc.v2(c,i),r=cc.v2(a,n),l=cc.v2(c,n),h=cc.v2(a+(c-a)/2,i),p=cc.v2(a+(c-a)/2,n),u=cc.v2(a,i+(n-i)/2),d=cc.v2(c,i+(n-i)/2);return this._collisionTest([o,s,r,l,h,p,u,d],e)},_collisionTest:function(t,e){var i=t.shift(),n=this.mapLayer0.getTileGIDAt(cc.v2(parseInt(i.x/this._curMapTileSize.width),parseInt(i.y/this._curMapTileSize.height)));return this._tiledMapData.gidToTileType[n]!=this._tiledMapData.tileType.tileNone&&this._tiledMapData.gidToTileType[n]!=this._tiledMapData.tileType.tileGrass?(e&&this._tiledMapData.gidToTileType[n]==this._tiledMapData.tileType.tileWall&&this.mapLayer0.removeTileAt(cc.v2(parseInt(i.x/this._curMapTileSize.width),parseInt(i.y/this._curMapTileSize.height))),!0):0<t.length&&this._collisionTest(t,e)},addPlayerTank:function(t){if(0<this.tankPool.size()){var e=this.tankPool.get();e.getComponent(cc.Sprite).spriteFrame=this.spriteFrames[this.spriteFrames.length-1],e.position=this.bornPoses[this.bornPoses.length-1];var i=e.getComponent("TankScript");return i.tankType=n.Player,i.speed=this.tankSpeeds[this.tankSpeeds.length-1],i.fireTime=this.tankFireTimes[this.tankFireTimes.length-1],i.blood=this.tankBloods[this.tankBloods.length-1],i.die=!1,t?i.team=t:cc.gameData.single?i.team=0:i.team=++cc.gameData.teamId,e.parent=this.tankNode,cc.gameData.tankList.push(e),e}return null},addAITank:function(t,e){if(0<this.tankPool.size()){var i=this.tankPool.get(),n=parseInt(3*Math.random(),10),a=i.getComponent("TankScript");if(i.getComponent(cc.Sprite).spriteFrame=this.spriteFrames[n],i.position=this.bornPoses[n],a.tankType=n,a.speed=this.tankSpeeds[n],a.fireTime=this.tankFireTimes[n],a.blood=this.tankBloods[n],a.die=!1,e?a.team=e:cc.gameData.single?a.team=1:a.team=++cc.gameData.teamId,0==n?i.rotation=90:1==n?i.rotation=180:2==n&&(i.rotation=270),a.collisionTank(i.getBoundingBox()))for(var c=0;c<this.bornPoses.length-1&&(i.position=this.bornPoses[c],a.collisionTank(i.getBoundingBox()));c++);i.parent=this.tankNode,cc.gameData.tankList.push(i)}},tankBoom:function(t){t.parent=null,t.getComponent("TankScript").die=!0,this.tankPool.put(t),cc.gameData.single&&0==t.getComponent("TankScript").team&&cc.director.loadScene("StartScene")},fireBtnClick:function(){this._playerTankCtrl.startFire(this.bulletPool)&&cc.audioEngine.play(this._playerTankCtrl.shootAudio,!1,1)},onDestroy:function(){this.unschedule(this.addAITank,this)}}),cc._RF.pop()},{TankData:"TankData",TiledMapData:"TiledMapData"}],JoystickCtrl:[function(t,e,i){"use strict";cc._RF.push(e,"dae4fVvAkJBQYB/rfJD67I3","JoystickCtrl");var a=cc.Enum({DEFAULT:0,FOLLOW:1}),n=cc.Enum({FOUR:0,EIGHT:1,ALL:2});cc.Class({extends:cc.Component,properties:{joystickBar:{default:null,type:cc.Node},joystickBG:{default:null,type:cc.Node},radius:0,touchType:{default:a.DEFAULT,type:a},directionType:{default:n.ALL,type:n},curAngle:{default:0,visible:!1},distance:{default:0,visible:!1}},onLoad:function(){0==this.radius&&(this.radius=this.joystickBG.width/2),this.registerInput(),this.distance=0,this.curAngle=0,this.initPos=this.node.position,this.node.opacity=50},addJoyStickTouchChangeListener:function(t){this.angleChange=t},registerInput:function(){var i=this;this._listener=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(t,e){return i.onTouchBegan(t,e)},onTouchMoved:function(t,e){i.onTouchMoved(t,e)},onTouchEnded:function(t,e){i.onTouchEnded(t,e)}},i.node)},onTouchBegan:function(t,e){if(this.touchType==a.FOLLOW){var i=this.node.parent.convertToNodeSpaceAR(t.getLocation());return this.node.setPosition(i),!0}i=this.node.convertToNodeSpaceAR(t.getLocation());var n=cc.pDistance(i,cc.p(0,0));return n<this.radius&&(20<n&&(this.node.opacity=255,this.joystickBar.setPosition(i),this._getAngle(i)),!0)},onTouchMoved:function(t,e){var i=this.node.convertToNodeSpaceAR(t.getLocation()),n=cc.pDistance(i,cc.p(0,0));if(this.radius>=n)20<n?(this.node.opacity=255,this.joystickBar.setPosition(i),this._getAngle(i)):(this.node.opacity=50,this.joystickBar.setPosition(cc.p(0,0)),this.curAngle=null,this.angleChange&&this.angleChange(this.curAngle));else{var a=Math.cos(this._getRadian(i))*this.radius,c=Math.sin(this._getRadian(i))*this.radius;0<i.x&&i.y<0?c*=-1:i.x<0&&i.y<0&&(c*=-1),this.joystickBar.setPosition(cc.p(a,c)),this._getAngle(i)}},onTouchEnded:function(t,e){this.node.opacity=50,this.touchType==a.FOLLOW&&(this.node.position=this.initPos),this.joystickBar.setPosition(cc.p(0,0)),this.curAngle=null,this.angleChange&&this.angleChange(this.curAngle)},_getAngle:function(t){return this._angle=Math.floor(180*this._getRadian(t)/Math.PI),0<t.x&&t.y<0?this._angle=360-this._angle:t.x<0&&t.y<0?this._angle=360-this._angle:t.x<0&&0==t.y?this._angle=180:0<t.x&&0==t.y?this._angle=0:0==t.x&&0<t.y?this._angle=90:0==t.x&&t.y<0&&(this._angle=270),this._updateCurAngle(),this._angle},_getRadian:function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return this._radian=0==e?0:Math.acos(t.x/e),this._radian},_updateCurAngle:function(){switch(this.directionType){case n.FOUR:this.curAngle=this._fourDirections();break;case n.EIGHT:this.curAngle=this._eightDirections();break;case n.ALL:this.curAngle=this._angle;break;default:this.curAngle=null}this.angleChange&&this.angleChange(this.curAngle)},_fourDirections:function(){return 45<=this._angle&&this._angle<=135?90:225<=this._angle&&this._angle<=315?270:this._angle<=225&&180<=this._angle||135<=this._angle&&this._angle<=180?180:this._angle<=360&&315<=this._angle||0<=this._angle&&this._angle<=45?0:void 0},_eightDirections:function(){return 67.5<=this._angle&&this._angle<=112.5?90:247.5<=this._angle&&this._angle<=292.5?270:this._angle<=202.5&&180<=this._angle||157.5<=this._angle&&this._angle<=180?180:this._angle<=360&&337.5<=this._angle||0<=this._angle&&this._angle<=22.5?0:112.5<=this._angle&&this._angle<=157.5?135:22.5<=this._angle&&this._angle<=67.5?45:202.5<=this._angle&&this._angle<=247.5?225:292.5<=this._angle&&this._angle<=337.5?315:void 0},onDestroy:function(){cc.eventManager.removeListener(this._listener)}}),cc._RF.pop()},{}],NoTouchScript:[function(t,e,i){"use strict";cc._RF.push(e,"006beoNQNNHAL+jJtWDR7Tw","NoTouchScript"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._listener=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(t,e){return e.stopPropagation(),!0},onTouchMoved:function(t,e){e.stopPropagation()},onTouchEnded:function(t,e){e.stopPropagation()}},this.node),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(t){t.stopPropagation()},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(t){t.stopPropagation()},this)}}),cc._RF.pop()},{}],StartScript:[function(t,e,i){"use strict";cc._RF.push(e,"f8dfbi1cPZJIqQT0xgFEygS","StartScript"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.globalData||(cc.globalData={})},loadChoiceScene:function(){cc.director.loadScene("ChoiceScene")}}),cc._RF.pop()},{}],TankData:[function(t,e,i){"use strict";cc._RF.push(e,"b9949Ww8jpJ1Kwi2x0Vtnnc","TankData");var n=cc.Enum({Normal:0,Speed:1,Armor:2,Player:3});e.exports={tankType:n},cc._RF.pop()},{}],TankScript:[function(t,e,i){"use strict";cc._RF.push(e,"6ce61tIUVFH+4QczJMrP1cD","TankScript");var n=t("TankData").tankType;cc.Class({extends:cc.Component,properties:{tankType:{default:n.Normal,type:n},speed:20,bullet:cc.Prefab,fireTime:.5,blood:1,team:0,blast:cc.Prefab,shootAudio:{default:null,url:cc.AudioClip},die:!1},onLoad:function(){this._cityCtrl=cc.find("/CityScript").getComponent("CityScript"),this.bulletNode=cc.find("/Canvas/Map/bullet")},start:function(){if(this.stopMove=!0,this.offset=cc.v2(),this.tankType!=n.Player){var e=this,t=cc.callFunc(function(){var t=parseInt(4*Math.random(),10);e.tankMoveStart([0,90,180,270][t]),e.startFire(e._cityCtrl.bulletPool)},this),i=cc.sequence(cc.delayTime(.3),t,cc.delayTime(1));this.node.runAction(cc.repeatForever(i))}},tankMoveStart:function(t){this.node.rotation=90-t,this.offset=0==t||180==t||90==t?cc.v2(Math.floor(Math.cos(Math.PI/180*t)),Math.floor(Math.sin(Math.PI/180*t))):270==t?cc.v2(Math.ceil(Math.cos(Math.PI/180*t)),Math.floor(Math.sin(Math.PI/180*t))):cc.v2(Math.cos(Math.PI/180*t),Math.sin(Math.PI/180*t)),this.stopMove=!1},tankMoveStop:function(){this.stopMove=!0},update:function(t){if(!this.stopMove){var e=this.node.getBoundingBox(),i=cc.rect(e.xMin+this.offset.x*this.speed*t*1.5,e.yMin+this.offset.y*this.speed*t*1.7,e.size.width,e.size.height);this._cityCtrl.collisionTest(i)||this.collisionTank(i)?this.tankMoveStop():(this.node.x+=this.offset.x*this.speed*t,this.node.y+=this.offset.y*this.speed*t)}this.stopFire&&(this.fireTime-=t,this.fireTime<=0&&(this.stopFire=!1))},collisionTank:function(t){for(var e=0;e<cc.gameData.tankList.length;e++){var i=cc.gameData.tankList[e];if(this.node!==i){var n=i.getBoundingBox();if(cc.rectIntersectsRect(t,n))return!0}}return!1},startFire:function(t){if(this.stopFire)return!1;this.stopFire=!0,this.fireTime=.5;var e=null;(e=0<t.size()?t.get(t):cc.instantiate(this.bullet)).rotation=this.node.rotation;var i=this.node.position,n=90-this.node.rotation,a=cc.v2(0,0);return a=0==n||180==n||90==n?cc.v2(Math.floor(Math.cos(Math.PI/180*n)),Math.floor(Math.sin(Math.PI/180*n))):270==n?cc.v2(Math.ceil(Math.cos(Math.PI/180*n)),Math.floor(Math.sin(Math.PI/180*n))):cc.v2(Math.cos(Math.PI/180*n),Math.sin(Math.PI/180*n)),e.position=cc.pAdd(i,cc.v2(10*a.x,10*a.y)),e.getComponent("BulletScript").bulletMove(),e.parent=this.bulletNode,e.tag=this.team,cc.gameData.bulletList.push(e),!0},boom:function(){var t=cc.instantiate(this.blast);t.parent=this.node.parent,t.position=this.node.position,t.getComponent(cc.Animation).play(),this._cityCtrl.tankBoom(this.node)}}),cc._RF.pop()},{TankData:"TankData"}],TiledMapData:[function(t,e,i){"use strict";cc._RF.push(e,"e0850dHf3VMs6DaFbgNuP0k","TiledMapData");var n=cc.Enum({tileNone:0,tileGrass:1,tileSteel:2,tileWall:3,tileRiver:4,tileKing:5}),a=[n.tileNone,n.tileNone,n.tileNone,n.tileGrass,n.tileGrass,n.tileSteel,n.tileSteel,n.tileNone,n.tileNone,n.tileGrass,n.tileGrass,n.tileSteel,n.tileSteel,n.tileWall,n.tileWall,n.tileRiver,n.tileRiver,n.tileKing,n.tileKing,n.tileWall,n.tileWall,n.tileRiver,n.tileRiver,n.tileKing,n.tileKing,n.tileKing,n.tileKing,n.tileNone,n.tileNone,n.tileNone,n.tileNone,n.tileKing,n.tileKing,n.tileNone,n.tileNone,n.tileNone,n.tileNone];e.exports={tileType:n,gidToTileType:a},cc._RF.pop()},{}]},{},["JoystickCtrl","AssetsLoadScript","BlastScript","BulletScript","ChoiceScript","CityScript","NoTouchScript","StartScript","TankData","TankScript","TiledMapData"]);